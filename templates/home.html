<!DOCTYPE html>
<html>
<head>
  <title>Runlala AI SEO Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>

</head>
<body class="bg-light">

<h1 class="text-center fs-1">Runlala AI SEO Tool</h1>

<div class="container-fluid mt-5 mb-4">
  <div class="row">
    <div class="col-6">
      <h2>输入内容</h2>
      <form id="seoForm">
        <div class="m-2">
          <label for="keywords"> 关键词</label>
          <textarea class="form-control" id="keywords" rows="3" placeholder="关键词，多个关键词换行分隔"></textarea>
        </div>

        <div class="m-2">
          <label for="html"> 原HTML内容</label>
          <textarea class="form-control" id="html" rows="25" placeholder="原HTML内容"></textarea>

        </div>

        <div class="m-2">
          <button type="submit" id="submit-btn" class="btn btn-primary save-job-btn">提交</button>
        </div>
      </form>
    </div>

    <div class="col-6">
      <h2>输出内容</h2>
      <div class="m-2">
        <label for="short-description"> 短描述</label>
        <textarea readonly class="form-control" id="short-description" rows="3" placeholder="短描述，点击复制"></textarea>
      </div>

      <div class="m-2">
        <label for="revised-html"> 新HTML内容</label>
        <textarea readonly class="form-control" id="revised-html" rows="25" placeholder="新HTML内容，点击复制"></textarea>
      </div>
    </div>
  </div>
</div>

<script type="application/javascript">
    // Form submission handling
    document.getElementById('seoForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const keywords = document.getElementById('keywords').value;
        const html = document.getElementById('html').value;
        const btn = document.getElementById('submit-btn');

        btn.disabled = true;
        oldText = btn.innerText;
        btn.innerText = 'Generating...';

        // Post the form data to the /generate API
        const response = await fetch('/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                keywords: keywords,
                html: html
            })
        });

        if (!response.ok) {
            alert('Error generating content. Please try again.');
            btn.disabled = false;
            btn.innerText = oldText;
            return;
        }

        const data = await response.json();
        if (!data.success) {
            alert(data.error);
            btn.disabled = false;
            btn.innerText = oldText;
            return;
        }

        document.getElementById('short-description').value = data.content.short_description || '';
        document.getElementById('revised-html').value = data.content.revised_html || '';
        btn.disabled = false;
        btn.innerText = oldText;
    });

    // Copy content to clipboard when user clicks on a textarea
    document.getElementById('short-description').addEventListener('click', function() {
        copyToClipboard(this);
    });

    document.getElementById('revised-html').addEventListener('click', function() {
        copyToClipboard(this);
    });

    // Function to copy text to clipboard
    function copyToClipboard(element) {
        element.select();
        document.execCommand('copy');
        alert('Content copied to clipboard');
    }
</script>
</body>
</html>